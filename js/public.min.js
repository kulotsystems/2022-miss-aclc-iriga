$(function(){var t=$(".table-ratings"),e=$("body").attr("data-id");function n(t){var e,n=t.length-1,a=t;do{e=!1;for(var i=0;i<n;i++)if(a[i]<a[i+1]){var r=a[i];a[i]=a[i+1],a[i+1]=r,e=!0}n--}while(e);return a}$.ajax({type:"POST",url:"../php/admin_results.php",data:{get_real_time_results_for:e},success:function(a){for(var i=JSON.parse(a),r=i[0],d=[],l=[],s=[],h=[],o=0;o<r.length;o++){for(var f=r[o],g=f[0],c=f[1],m=parseFloat(f[2]),v=parseFloat(f[3]),p=t.find(".tr-candidate[data-id='"+g+"']"),u=0,b=0;b<c.length;b++){var C=c[b],S=C[0],x=parseFloat(C[1]),I=C[2];u+=parseFloat(x);var y,N=p.find(".td-judge-total[data-id='"+S+"']");y=x.toFixed(2),N.html(y),"bg-white"==I?N.hasClass("bg-eee")&&(N.removeClass("bg-eee"),N.addClass("bg-white")):"bg-eee"==I&&N.hasClass("bg-white")&&(N.removeClass("bg-white"),N.addClass("bg-eee"))}var T=u/c.length;if(100!=v){var F=T*(v/100);p.find(".td-judge-average").html(T.toFixed(2).toString()),p.find(".td-judge-weight").html(F.toFixed(2).toString()),T=F+m}p.find(".td-average").html(T.toFixed(2).toString()),d.indexOf(parseFloat(T))<0&&d.push(parseFloat(T)),l.push(g),s.push(parseFloat(T))}d=n(d),t.find(".tr-candidate.winner").each(function(t){$(this).removeClass("winner")});var A={},R=-1,E=-1;for(o=0;o<l.length;o++){g=l[o];var M=s[o],k=d.indexOf(M)+1;null==A[k]&&(A[k]=[]),A[k].push(g),R<0&&(R=k),E<0&&(E=k),k<=R&&(R=k),k>=E&&(E=k),(p=t.find(".tr-candidate[data-id='"+g+"']")).find(".td-rank").html(k.toString()),h.push(k);var W=t.find("td.bg-eee");if(W.length<=0)if(2==e||3==e||5==e)1==k&&p.addClass("winner");else if(6==e){for(var O=0;O<d.length&&d[O]!=M;O++);k>=1&&k<=10&&W.length<=0&&p.addClass("winner")}}for(var j=1,L=R;L<=E;L++){var U=j;if(A[L].length>1){let t=0;for(let e=0;e<A[L].length;e++)t+=j+e;U=t/A[L].length}for(var P=0;P<A[L].length;P++){var _=A[L].length>1?Number(U).toLocaleString():j;$('.tr-candidate[data-id="'+A[L][P]+'"]').find(".td-rank-2").html(Number(_).toFixed(1).replace(".0","")),j+=1}}var z=i[1];for(o=0;o<z.length;o++){S=z[o][0],I=z[o][1];var D=t.find(".th-judge[data-id='"+S+"']");"bg-white"==I?D.hasClass("bg-eee")&&(D.removeClass("bg-eee"),D.addClass("bg-white")):"bg-eee"==I&&D.hasClass("bg-white")&&(D.removeClass("bg-white"),D.addClass("bg-eee"))}for(var B=[],G=n(h).reverse(),J=0;J<G.length-1;J++)for(var K=J+1;K<G.length;K++)-2!=G[K]&&G[J]==G[K]&&(B.indexOf(G[J])<0&&B.push(G[J]),G[K]=-2);B.length>0&&console.log("Tie at rank "+B.join(", "));var H=t.find(".tr-candidate");if(2==e||3==e||5==e)H.each(function(t){var e=$(this);if("1"==$(this).find(".td-rank").html())return $("#spWinnerCandidateNo").html(e.find(".candidate-no").html()),$("#imgWinnerPhoto").attr("src",e.find(".img-candidate").attr("src")),$("#spWinnerName").html(e.find(".candidate-fullname").html()),$("#spWinnerAddress").html(e.find(".candidate-city").html()),0});else if(6==e){for(var V=0,Y=t.find(".tr-candidate.winner"),q=1;q<=10;q++)Y.each(function(e){var n=$(this);n.find(".td-rank").html()==q.toString()&&(V+=1)>10&&(n.removeClass("winner"),console.log("ELIMINATED RANK: "+q.toString()),t.find(".tr-candidate.winner").each(function(){$(this).find(".td-rank").html()==q.toString()&&console.log("MUST INITIATE TIE BREAKER FROM JUDGES!")}))});var Q=[];t.find(".tr-candidate.winner").each(function(){Q.push($(this).find(".candidate-no").html())}),Q.sort(function(){return.5-Math.random()});for(var X="<table cellspacing='2'>",Z=0;Z<Q.length;Z++){X+="<tr>",X+="<td style='width: 64px; height: 64px;' align='center'>",X+="<div style='width: 100%; height: 100%; border: 2px solid red; border-radius: 50%'>",X+="<table style='width: 100%; height: 100%;'><tr><td align='center'>",X+="<b>"+Q[Z]+"</b>",X+="</td></tr></table>",X+="</div>",X+="</td>",X+="<td style='padding-left: 5px'>",X+="<ul style='list-style-type: none; margin: 0; padding: 0'>";var tt=t.find(".tr-candidate[data-id='"+Q[Z]+"']");X+="<li style='line-height: 1; font-size: 0.9em'>"+tt.find(".candidate-fullname").html()+"</li>",X+="<li style='line-height: 1; font-size: 0.6em; text-transform: uppercase'>"+tt.find(".candidate-city").html()+"</li>",X+="</ul>",X+="</td>",X+="</tr>"}X+="</table>",$("#spTop10").html(X)}else if(7==e){H.each(function(t){$(this).find(".td-title").html(""),$(this).hasClass("winner")&&$(this).removeClass("winner")});var et=["MISS ACLC IRIGA 2022","MISS ACLC SILVER 2022","MISS ACLC CHARITY 2022","1ST RUNNER UP","2ND RUNNER UP"];for(w=0;w<et.length;w++)for(var nt=1;nt<=10;nt++){var at=!1;if(H.each(function(t){if(parseInt($(this).find(".td-rank").html())==nt){var e=$(this).find(".td-title");if(""==e.html())return e.html(et[w]),at=!0,0}}),at)break}(W=t.find("td.bg-eee")).length<=0&&H.each(function(t){""!=$(this).find(".td-title").html()&&($(this).hasClass("winner")||$(this).addClass("winner"))}),H.each(function(t){var e=$(this),n=$(this).find(".td-title"),a=et.indexOf(n.html());if(a>-1){a+=1;var i=$("#spWinnerCandidateNo"+a.toString()),r=$("#imgWinnerPhoto"+a.toString()),d=$("#spWinnerName"+a.toString()),l=$("#spWinnerAddress"+a.toString());i.html("#"),r.attr("src",""),d.html(""),l.html(""),i.html(e.find(".candidate-no").html()),r.attr("src",e.find(".img-candidate").attr("src")),d.html(e.find(".candidate-fullname").html()),l.html(e.find(".candidate-city").html())}})}}});var a=$("#divCardBodyTabulator"),i=$("#tblTabulator");function r(){var t=(parseInt(a.css("height"))-parseInt(i.css("height")))/2+40;i.css({"margin-top":t.toString()+"px"})}r(),window.onresize=function(){r()};var d=t.find("#trMainTheadTr").find("th").length-1;t.find("#tdColspanMe").attr("colspan",d.toString())});
